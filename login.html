<html>
  <head>
    <title>Malta</title>
    <link rel="stylesheet" href="astyle.css">
  </head>
  <body>
    <div class="container">
      <div class="card">
        <h2>Login</h2>
        <form id="loginForm">
          <input type="text" id="username" name="username" placeholder="Username" required>
          <input type="password" id="password" name="password" placeholder="Password" required>
          <button type="submit">Login</button>
        </form>
        <div id="error" style="color:red;"></div>
      </div>
    </div>

    <script>
      // Decide API base URL based on hostname (localhost vs live server)
      const API_BASE_URL = window.location.hostname === "127.0.0.1" || window.location.hostname === "localhost"
        ? "http://127.0.0.1:8001"
        : "http://167.86.74.89";
    
      document.getElementById('loginForm').addEventListener('submit', function(e) {
        e.preventDefault();
    
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
    
        fetch(`${API_BASE_URL}/api/token/`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ username, password })
        })
        .then(response => {
          if (!response.ok) throw new Error("Invalid credentials");
          return response.json();
        })
        .then(data => {
          localStorage.setItem('access_token', data.access);
          localStorage.setItem('refresh_token', data.refresh);
          window.location.href = 'dashboard.html';  // Redirect after login
        })
        .catch(error => {
          document.getElementById('error').textContent = error.message;
        });
      });
    </script>
    
  </body>
</html>
